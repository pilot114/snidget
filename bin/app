#!/usr/local/bin/php
<?php

use Snidget\CommandHandler;
use Snidget\Schema\Config\AppPaths;
use Snidget\PSR\Container;

include_once __DIR__ . '/../vendor/autoload.php';

// ./app Test:run -a hello -a world -b=test -de one --gamma test2 two three1 three2

$handler = new CommandHandler($argv);

// TODO: module prefix for commands
$container = new Container();
$paths = $container->get(AppPaths::class, [
    'appPath' => '/app/App',
])->getCommandPaths();
$commandData = $handler->extractCommand($paths);
if ($commandData === []) {
    $handler->default($paths);
} else {
    [$dtoName, $data, $commandClassName, $commandMethodName] = $commandData;
    $container->get($dtoName, ['array' => $data]);
    $container->call($commandClassName, $commandMethodName);
}
